@page "/FarmerAccount"
@inject NavigationManager NavManager
@using Newtonsoft.Json;

<center>
    <MudPaper Elevation="10" Height="47px" Width="100%">
        <MudText Class="pt-2" Typo="Typo.h5">Account</MudText>
    </MudPaper>
</center>

<MudText Typo="Typo.h5">Profile</MudText>
<MudText Typo="Typo.h5">Orders</MudText>
<MudText Typo="Typo.h5">Address</MudText>
<MudText Typo="Typo.h5">Payment</MudText>


<MudButton Class="mt-2" @onclick="LogOutUser" Variant="Variant.Filled" Color="Color.Inherit">Logout</MudButton>

@code {
    private async Task LogOutUser()
    {
        HttpClient client = new HttpClient { BaseAddress = new Uri("https://farmersmercato.azurewebsites.net/api/log-in") };

        HttpResponseMessage response = null;
        response = await client.GetAsync(client.BaseAddress);

        var data = await response.Content.ReadAsStringAsync();
        dynamic accounts = JsonConvert.DeserializeObject(data);

        foreach (var account in accounts)
        {
            if (account.loggedIn == true)
            {
                UpdateLoggedInVar(account.username, false);
            }
        }

        NavManager.NavigateTo("/");

        return;
    }

    private async Task UpdateLoggedInVar(string username, bool isLoggedIn)
    {
        HttpClient client = new HttpClient { BaseAddress = new Uri("https://farmersmercato.azurewebsites.net/api/update-loggedIn-" + username) };

        HttpResponseMessage response = null;

        var payloadString = new StringContent(System.Text.Json.JsonSerializer.Serialize(isLoggedIn), System.Text.Encoding.UTF8, System.Net.Mime.MediaTypeNames.Application.Json);

        response = await client.PutAsync(client.BaseAddress, payloadString);

        return;
    }
}

<style>
    center {
        text-align: center
    }

    #user-nav-bar {
        visibility: hidden;
    }
</style>